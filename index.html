<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>兑换码管理</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f5f5f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .top-text {
            color: red;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
            text-align: center;
            flex-shrink: 0;  /* 防止压缩 */
        }

        .image-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            flex-shrink: 0;  /* 防止压缩 */
        }

        img {
            width: 100%;
            height: auto;
            display: block;
        }

        .content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 15px 0;
            flex-shrink: 0;  /* 防止压缩 */
        }

        .input-section {
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;  /* 增加底部间距 */
        }

        #copy-section {
            display: none;
            width: 100%;
            max-width: 400px;
            gap: 10px;
            flex-direction: column;
        }

        button {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border-radius: 8px;
            border: none;
            color: white;
        }

        /* 验证按钮保持蓝色 */
        .verify-btn {
            background: #007AFF;
        }

        /* 复制账号按钮设为浅黄色 */
        .copy-account-btn {
            background: #FFB340;  /* 浅黄色 */
        }

        /* 复制密码按钮设为浅绿色 */
        .copy-password-btn {
            background: #4CD964;  /* 浅绿色 */
        }

        input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
        }

        h1 {
            font-size: 16px;
            margin: 10px 0;
        }

        .bottom-section {
            margin-top: auto;  /* 推到底部 */
            flex-shrink: 0;    /* 防止压缩 */
        }

        .bottom-text {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .red-text {
            color: red;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .highlighted-text {
            color: #007AFF;
            font-size: 16px;
            font-weight: bold;
        }

        .yellow-text {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
            margin: 10px 0;
            display: flex;
            align-items: center;
        }

        .yellow-text::before {
            content: "•";
            color: #007AFF;
            font-size: 20px;
            margin-right: 8px;
        }

        .bottom-red-text {
            color: #999;
            font-size: 12px;
            text-align: center;
            margin: 15px 0;
            padding: 0 15px;
        }
    </style>
</head>
<body>
    <div class="top-text">
        ☆☆☆严格把教程看完☆☆☆
    </div>

    <div class="image-container">
        <img src="assets/jc.png" alt="教程说明">
    </div>

    <div class="content-wrapper">
        <div class="input-section">
            <h1>输入兑换码</h1>
            <input type="text" id="code-input" placeholder="请输入兑换码">
            <button onclick="verifyCode()" class="verify-btn">验证</button>
        </div>

        <div id="copy-section">
            <button id="copy-account" class="copy-account-btn">复制账号</button>
            <button id="copy-password" class="copy-password-btn">复制密码</button>
        </div>
    </div>

    <div class="bottom-section">
        <div class="bottom-text">
            <p class="red-text">注意事项！！！</p>
            <p class="yellow-text">请不要在淘宝说（账号，id，ios，美区）等敏感词</p>
            <p class="yellow-text">有售后问题请直接咨询VX客服：<span class="highlighted-text">Tbb_0vO</span></p>
        </div>

        <div class="bottom-red-text">
            * 请勿恶意咨询违禁词，客服将不给与回复，如有问题请联系VX客服 *
        </div>
    </div>

    <script>
        // 使用分散的字符片段，增加逆向难度
        const _0x5f2a = ['value', 'charCodeAt', 'length', 'map', 'join', 'split'];
        const _0x3e8b = ['floor', 'random', 'toString', 'slice', 'push', 'shift'];

        // 混淆关键的密钥片段
        const _k = {
            a: 'Ym9v',
            b: 'ZHJp',
            c: 'dmVy',
            d: ['aW5n', 'QWJj', 'ZGVm'],
            e: ['SGVs', 'bG8=']
        };

        // Base64解码函数
        function _atob(str) {
            try {
                return decodeURIComponent(escape(window.atob(str)));
            } catch {
                // 如果原生atob失败，使用自定义实现
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
                let output = '';
                str = str.replace(/[^A-Za-z0-9\+\/\=]/g, '');
                for (let i = 0; i < str.length;) {
                    const enc1 = chars.indexOf(str.charAt(i++));
                    const enc2 = chars.indexOf(str.charAt(i++));
                    const enc3 = chars.indexOf(str.charAt(i++));
                    const enc4 = chars.indexOf(str.charAt(i++));
                    
                    const chr1 = (enc1 << 2) | (enc2 >> 4);
                    const chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
                    const chr3 = ((enc3 & 3) << 6) | enc4;
                    
                    output += String.fromCharCode(chr1);
                    if (enc3 !== 64) output += String.fromCharCode(chr2);
                    if (enc4 !== 64) output += String.fromCharCode(chr3);
                }
                return output;
            }
        }

        // 真正的密钥生成函数
        function _0x2b4a() {
            const _p = [_k.d[0], _k.d[1], _k.d[2], _k.e[0], _k.e[1]];
            return _atob(_p.join(''));
        }

        // 解密函数
        function decrypt(encoded) {
            try {
                const key = _0x2b4a();
                const text = _atob(encoded);
                let result = '';
                
                for(let i = 0; i < text.length; i++) {
                    const charCode = text.charCodeAt(i) ^ key.charCodeAt(i % key.length);
                    result += String.fromCharCode(charCode);
                }
                
                return result;
            } catch(e) {
                console.error('解密失败:', e);
                return '';
            }
        }

        // 加密数据 - 一行字符串
        const _0x4f8a = "USZRAzMhJy4xHSwu.PSkpByNRPS0+cDBV.I1cuGDMuJiEuGy01.JyMlDlYyLSswD1xf|BwsVJAwHDQIEJwYeLBYIBgguTAALCA==|PRpeeFZXXF0=@LT4iCFctLiQiEiNb.L1dfES0hPj9XGCcl.I1heFVMxU1IrfSk7.MzwxAlA7NlQ1ACk2|DAsLKgcOBQgELhYNGS8QDw8uDU0HCgs=|PRpeeFRVUFE=@I1cpeScsVjcoBFA0.IScvCys3UyA/eD1a.Ljs+ciBWMyIzGTNa.Jl8hDSY1UC9XHyIg|BFgRJBsMAF0WeVMKLAgEFkkiDQ4=|PRpeeFRVUFE=@XChUFTohPDEqC1cg.JSRWeTdSIlU1fzQj.Ky0wc1dQUl0sHFMq.JS9UCFoiKDdUcCw4|BFsWJQEJJA0eMQgAQgwGAw==|PRpWcFBRXVw=@XyJSEDpVN1BQDzUm.UFgyGCMqN1MoGS0n.WyNRdlYkUChTDTw+.WCAqEDcsITQifi0t|DBYGLBIPAVAmJQQFAEEKAQo=|OS4UMhVTFgFT";

        // 构建加密数据
        const encryptedData = {};
        _0x4f8a.split('@').forEach((group, index) => {
            const [codes, account, password] = group.split('|');
            encryptedData[`group${index + 1}`] = {
                codes: codes.split('.'),
                account,
                password
            };
        });

        // 获取解密数据的函数
        function getCodeMapping() {
            const decryptedData = {};
            for (const group in encryptedData) {
                decryptedData[group] = {
                    codes: encryptedData[group].codes.map(code => decrypt(code)),
                    account: decrypt(encryptedData[group].account),
                    password: decrypt(encryptedData[group].password)
                };
            }
            return decryptedData;
        }

        const cooldownTime = 3 * 30 * 24 * 60 * 60 * 1000;  // 90天
        const activeTime = 24 * 60 * 60 * 1000;  // 24小时

        function verifyCode() {
            const userCode = document.getElementById("code-input").value;
            let found = false;
            
            // 获取解密后的数据
            const codeMapping = getCodeMapping();

            for (const key in codeMapping) {
                const group = codeMapping[key];
                if (group.codes.includes(userCode)) {
                    const lastUsedTime = getLastUsedTime(userCode);
                    const now = Date.now();

                    if (lastUsedTime) {
                        const timeDiff = now - lastUsedTime;
                        
                        if (timeDiff <= activeTime) {
                            // 在24小时活跃期内，允许使用
                            showSuccessResult(group);
                            found = true;
                            break;
                        } else if (timeDiff < cooldownTime) {
                            // 超过24小时但未到90天，提示无效
                            alert("兑换码正在冷却中，请等待" + Math.ceil((cooldownTime - timeDiff) / (24 * 60 * 60 * 1000)) + "天后再试！");
                            return;
                        } else {
                            // 超过90天，可以重新使用
                            setLastUsedTime(userCode);
                            showSuccessResult(group);
                            found = true;
                            break;
                        }
                    } else {
                        // 首次使用
                        setLastUsedTime(userCode);
                        showSuccessResult(group);
                        found = true;
                        break;
                    }
                }
            }

            if (!found) {
                alert("兑换码错误！");
                document.getElementById("copy-section").style.display = "none";
            }
        }

        // 显示成功结果
        function showSuccessResult(group) {
            document.getElementById("copy-section").style.display = "block";
            document.getElementById("copy-account").onclick = () => copyToClipboard("成功复制账号", group.account);
            document.getElementById("copy-password").onclick = () => copyToClipboard("成功复制密码", group.password);
            alert("兑换成功，24小时内可以重复使用！");
        }

        function isCooldownOver(lastUsedTime) {
            return Date.now() - lastUsedTime >= cooldownTime;
        }

        function setLastUsedTime(code) {
            localStorage.setItem(`lastUsed_${code}`, Date.now());
        }

        function getLastUsedTime(code) {
            const lastUsedTime = localStorage.getItem(`lastUsed_${code}`);
            return lastUsedTime ? parseInt(lastUsedTime, 10) : null;
        }

        function copyToClipboard(message, content) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(content)
                    .then(() => alert(message))
                    .catch(err => console.error("复制失败:", err));
            } else {
                fallbackCopyToClipboard(message, content);
            }
        }

        function fallbackCopyToClipboard(message, text) {
            const textarea = document.createElement("textarea");
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand("copy");
                alert(message);
            } catch (err) {
                console.error("复制失败", err);
            }
            document.body.removeChild(textarea);
        }
    </script>
</body>
</html>
